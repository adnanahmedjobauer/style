document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("postForm"),e=document.getElementById("add_img"),n=document.getElementById("post_img"),i=document.getElementById("submitButton"),a=document.getElementById("rmImg"),o="placeholder.jpg",r=()=>{const t=e.files[0];if(t&&t.type.startsWith("image/")){const o=URL.createObjectURL(t);n.src=o,a.style.display="flex",n.onload=()=>URL.revokeObjectURL(o)}else c(),showNotification("Error","Invalid image file!","alert-warning")},c=()=>{n.src=o,e.value="",a.style.display="none"},s=async e=>{e.preventDefault();const n=tinymce.get("description");if(!n)return void showNotification("Error","Editor is not initialized properly!","alert-danger");const a=new FormData(t);a.set("description",n.getContent()),i.innerHTML='<i class="fa fa-spinner fa-spin"></i> Submitting...',i.disabled=!0,i.setAttribute("aria-busy","true");try{const t=await fetch("backend/add_post.php",{method:"POST",body:a}),e=await t.text();"808080"===e.trim()?(showNotification("Success","Post added successfully!","alert-success","home"),t.reset(),c(),n.setContent("")):showNotification("Error",e,"alert-danger")}catch(t){console.error("Fetch Error:",t),showNotification("Error","Something went wrong! Please try again.","alert-danger")}finally{i.innerHTML="Submit",i.disabled=!1,i.removeAttribute("aria-busy")}};e.addEventListener("change",r),a.addEventListener("click",c),t.addEventListener("submit",s)});