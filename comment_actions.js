function handleAjaxError(xhr){showNotification("warning",xhr.responseText,"alert-warning");}function commentLike(id,post_id){const xhr=new XMLHttpRequest();xhr.open("POST","../backend/like_comment.php",true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(){if(xhr.status===200){const res=JSON.parse(xhr.responseText),btn=document.querySelector(`#comment_${id}`),act=res.action==="like"?"Liked":"Like",sty=res.action==="like"?"active":"",cnt=res.count;btn.innerHTML=`<span class="${sty}"><i class="fas fa-thumbs-up"></i> ${act} (${cnt})</span>`}else{handleAjaxError(xhr)}};xhr.send(`comment_id=${id}&post_id=${post_id}`);}function notification(){showNotification("warning","You arenâ€™t logged in","alert-warning");}function CNotification(id){showConfirmNotification("Alert","Are you sure you want to delete this comment?","alert-warning",()=>{deleteComment(id);});}function ConfirmdeleteReply(id){showConfirmNotification("Alert","Are you sure you want to delete this comment?","alert-warning",()=>{deleteReply(id);});}function toggleReplies(id){const r=document.getElementById(`replies-${id}`);if(r.style.display==="none"||r.style.display===""){fetch("../backend/view_replies.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`comment_id=${id}`}).then(r=>{if(!r.ok){return r.text().then(t=>{throw new Error(t);});}return r.text();}).then(d=>{r.innerHTML=d;r.style.display="block";}).catch(e=>{showNotification("warning",e.message,"alert-warning");});}else{r.style.display="none";}}function toggleReplyForm(id){const e=document.querySelector(`#edit-form-${id}`);e.style.display="none";const r=document.querySelector(`#reply-form-${id}`);document.querySelectorAll(".reply-form").forEach(i=>i.style.display==="block"&&(i.style.display="none"));r.style.display=r.style.display==="none"||r.style.display===""?"block":"none";}function toggleCommentEditForm(id){const r=document.querySelector(`#reply-form-${id}`);r.style.display="none";const e=document.querySelector(`#edit-form-${id}`);document.querySelectorAll(".edit-form").forEach(i=>i.style.display==="block"&&(i.style.display="none"));e.style.display=e.style.display==="none"||e.style.display===""?"block":"none";}function addReply(c,p){const t=document.querySelector(`#reply-text-${c}`).value,x=new XMLHttpRequest();x.open("POST","../backend/add_reply.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const r=JSON.parse(x.responseText);if(x.status===200&&r.status==="success"){document.querySelector(`#replies-${c}`).innerHTML+=r.reply_html;document.querySelector(`#reply-text-${c}`).value="";toggleReplies(c);toggleReplyForm(c);showNotification("success","Reply added successfully.","alert-success");}else{showNotification("error","Failed to add reply.","alert-danger");}};x.send(`comment_id=${c}&post_id=${p}&reply_text=${t}`);}function saveEdit(c){const t=document.querySelector(`#edit-text-${c}`).value,x=new XMLHttpRequest();x.open("POST","../backend/edit_comment.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const r=JSON.parse(x.responseText);if(x.status===200&&r.status==="success"){document.querySelector(`#comment-text-${c}`).textContent=t;toggleCommentEditForm(c);showNotification("success","Comment updated successfully.","alert-success");}else{showNotification("error","Failed to update comment.","alert-danger");}};x.send(`comment_id=${c}&comment_text=${t}`);}function deleteComment(c){const x=new XMLHttpRequest();x.open("POST","../backend/delete_comment.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const r=JSON.parse(x.responseText);if(x.status===200&&r.status==="success"){document.querySelector(`#comment-${c}`).remove();showNotification("success","Comment deleted successfully.","alert-success");}else{showNotification("error","Failed to delete comment.","alert-danger");}};x.send(`comment_id=${c}`);}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".comment-form").forEach(f=>{f.addEventListener("submit",e=>{e.preventDefault();const p=f.dataset.postId,c=f.querySelector("textarea[name='comment_text']").value,x=new XMLHttpRequest();x.open("POST","../backend/add_comment.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const d=JSON.parse(x.responseText);if(x.status===200&&d.status==="success"){document.querySelector("#comments").insertAdjacentHTML("afterbegin",d.comment_html);f.querySelector("textarea[name='comment_text']").value="";}showNotification(d.status,d.message,d.alert_class);};x.send(`post_id=${p}&comment_text=${c}`);});});});function toggleReplyEditForm(id){const t=document.querySelector(`#reply-text-${id}`),c=t.textContent.trim();t.innerHTML=`<div class="edit-reply-container p-3 bg-dark text-white rounded"><textarea id="edit-reply-text-${id}" class="form-control" rows="2">${c}</textarea><div class="d-flex justify-content-between gap-2"><button class="btn btn-success w-100" onclick="saveReplyEdit(${id})">Save</button><button class="btn btn-secondary w-100" onclick="cancelEdit(${id},'${c}')">Cancel</button></div></div>`;}function saveReplyEdit(id){const n=document.querySelector(`#edit-reply-text-${id}`).value,x=new XMLHttpRequest();x.open("POST","../backend/edit_reply.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const d=JSON.parse(x.responseText);if(x.status===200&&d.success){document.querySelector(`#reply-text-${id}`).textContent=n;showNotification("success","Reply updated successfully.","alert-success");}else{showNotification("error","Error updating reply.","alert-danger");}};x.send(`reply_id=${id}&reply_text=${n}`);}function cancelEdit(id,t){document.querySelector(`#reply-text-${id}`).textContent=t;}function deleteReply(id){const x=new XMLHttpRequest();x.open("POST","../backend/delete_reply.php",true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");x.onload=function(){const d=JSON.parse(x.responseText);if(x.status===200&&d.success){document.querySelector(`#reply-${id}`).remove();showNotification("success","Reply deleted successfully.","alert-success");}else{showNotification("error",d.message,"alert-danger");}};x.send(`reply_id=${id}`);}